# Cloudflare Workers Configuration

name = "on-tour-api-gateway"
main = "src/workers/edge/api-gateway.ts"
compatibility_date = "2024-10-01"
workers_dev = true

# Account details (replace with your own)
# account_id = "your-account-id"
# zone_id = "your-zone-id"

[build]
command = "npm run build:workers"
cwd = "./"
watch_dirs = ["src/workers/edge"]

[build.upload]
format = "service-worker"

# Environment Variables
[vars]
ENVIRONMENT = "production"
API_VERSION = "v1"
ENABLE_CACHE = "true"
CACHE_TTL = "300"

# KV Namespaces for data storage
[[kv_namespaces]]
binding = "REGION_DATA"
id = "your-kv-namespace-id"
preview_id = "your-preview-kv-id"

# R2 Bucket for static assets (optional)
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "on-tour-assets"
# preview_bucket_name = "on-tour-assets-preview"

# Routes - Define which URLs should be handled by workers
[[routes]]
pattern = "api.ontour.app/*"
zone_name = "ontour.app"

[[routes]]
pattern = "cdn.ontour.app/*"
zone_name = "ontour.app"

# Triggers - Cron triggers for periodic tasks
[triggers]
crons = ["0 0 * * *"] # Daily at midnight UTC for cache warming

# Limits
[limits]
cpu_ms = 50 # Max 50ms CPU time per request

# Observability
[observability]
enabled = true
head_sampling_rate = 1 # Sample 100% of requests

# Compatibility flags
compatibility_flags = [ "nodejs_compat" ]

# Multiple workers for different purposes
# You can duplicate this file for:
# - api-gateway.toml (API routing)
# - static-assets.toml (CDN)
# - geo-router.toml (Geo-location routing)
