<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0b0f14" />
    <title>On Tour App ‚Äî App</title>
    <link rel="icon" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/src/shared/styles/unified-styles.css" />
  <link rel="stylesheet" href="/src/shared/styles/app.css" />
  <link rel="stylesheet" href="/src/features/dashboard/styles/dashboard.css" />
  <link rel="stylesheet" href="/src/features/dashboard/styles/command-center.css" />
  <link rel="stylesheet" href="/src/features/dashboard/styles/calendar.css" />
  <link rel="stylesheet" href="/src/features/finance/styles/finance.css" />
  <link rel="stylesheet" href="/src/features/finance/styles/finance-enhanced.css" />
  <link rel="stylesheet" href="/src/features/dashboard/styles/manager.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  </head>
  <body>
  <a class="skip-link" href="#main">Skip to content</a>
    <div class="layout">
      <aside class="side">
        <a class="brand" href="/" aria-label="Home">
          <span class="logo">OTA</span>
          <span class="name">On Tour App</span>
        </a>
        <nav class="side-nav" aria-label="Primary">
          <a class="active" href="#/dashboard" data-link><i data-lucide="layout-dashboard"></i><span data-i18n="nav.dashboard">Dashboard</span></a>
          <a href="#/manager" data-link><i data-lucide="users"></i><span data-i18n="nav.manager">Manager</span></a>
          <a href="#/command-center" data-link><i data-lucide="command"></i><span data-i18n="nav.commandCenter">Command Center</span></a>
          <a href="#/calendar" data-link><i data-lucide="calendar"></i><span data-i18n="nav.calendar">Calendar</span></a>
          <a href="#/finance" data-link><i data-lucide="wallet"></i><span data-i18n="nav.finance">Finance</span></a>
          <a href="#/settings" data-link><i data-lucide="sliders-horizontal"></i><span data-i18n="nav.settings">Settings</span></a>
        </nav>
        <div class="side-spacer"></div>
        <div class="locale-select-wrapper" style="padding:8px 0;">
          <label for="localeSelect" class="visually-hidden" data-i18n="settings.locale.label">Language</label>
          <select id="localeSelect" class="small" aria-label="Language selector" data-i18n-label="settings.locale.label">
            <option value="en" data-i18n="settings.locale.en">English</option>
            <option value="es" data-i18n="settings.locale.es">Espa√±ol</option>
          </select>
        </div>
        <button id="logout" class="ghost">Logout</button>
  
        <!-- Travel Quick Add Modal -->
        <div id="travelModal" class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="travelModalTitle" hidden>
          <div class="modal-backdrop"></div>
          <div class="modal-dialog glass">
            <div class="modal-content">
              <header class="modal-header">
                <h2 id="travelModalTitle" class="command-title" data-i18n="modal.travel.title"><i data-lucide="plane"></i> Add travel</h2>
                <button class="ghost close-modal" aria-label="Close"><i data-lucide="x"></i></button>
              </header>
              <div class="modal-body">
                <div id="travelModalLive" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
                <div id="travelFormErrors" class="form-errors" style="display:none; margin-bottom:8px;"></div>
                <fieldset class="panel console-card">
                  <legend data-i18n="modal.travel.legend"><i data-lucide="align-left"></i> Travel Details</legend>
                  <form id="travelForm" class="form-grid-responsive cols-2">
                    <input type="hidden" id="travelShowId" />
                    <input type="hidden" id="travelKind" />
                    <label data-i18n="form.title">Title<input id="travelTitle" type="text" placeholder="e.g., Flight to Berlin" required /></label>
                    <label data-i18n="form.details">Details<input id="travelMeta" type="text" placeholder="Route / notes" /></label>
                    <label data-i18n="form.dateTime">Date & time<input id="travelDate" type="datetime-local" required /></label>
                    <label></label>
                  </form>
                </fieldset>
              </div>
              <footer class="modal-footer">
                <button class="ghost close-modal" data-i18n="btn.cancel">Cancel</button>
                <button id="saveTravelBtn" class="primary" data-i18n="btn.save">Save</button>
              </footer>
            </div>
          </div>
        </div>
      </aside>
      <main id="main" class="container">
      <!-- Global KPIs (ambient bar like Accounting app) -->
      <div id="global-kpis" class="global-kpis" aria-label="Business vitals">
        <span id="kpiLive" class="visually-hidden" aria-live="polite" aria-atomic="true"></span>
  <button class="kpi kpi-link" data-action="finance-year" aria-label="Open finance view (year net)" data-i18n-label="dashboard.kpi.yearNet" title="View full year financial breakdown" data-i18n-attr="title" data-i18n="kpi.title.financeYear"><span id="kpiNetLabel" class="kpi-label" data-i18n="dashboard.kpi.yearNet">Year Net</span><span id="kpiYtdNet" class="kpi-value">‚Ç¨0</span></button>
  <button class="kpi kpi-link" data-action="pending" aria-label="Scroll to pending actions" title="Jump to pending actions" data-i18n-attr="title" data-i18n="kpi.title.pending"><span class="kpi-label" data-i18n="dashboard.kpi.pending">Pending</span><span id="kpiPending" class="kpi-value">‚Ç¨0</span></button>
  <button class="kpi kpi-link" data-action="expenses-month" aria-label="Open finance month details" title="Open monthly expenses breakdown" data-i18n-attr="title" data-i18n="kpi.title.expensesMonth"><span class="kpi-label" data-i18n="dashboard.kpi.expensesMonth">Expenses (Month)</span><span id="kpiBurn30" class="kpi-value">‚Ç¨0</span></button>
  <button class="kpi kpi-link" data-action="net-month" aria-label="Open finance month net" title="Open monthly net detail" data-i18n-attr="title" data-i18n="kpi.title.netMonth"><span id="kpiPayoutLabel" class="kpi-label" data-i18n="dashboard.kpi.netMonth">Net (Month)</span><span id="kpiNextPayout" class="kpi-value" data-trend>‚Äî</span></button>
      </div>

  <!-- Dashboard Grid -->
      <section id="dashboard" class="view active" data-view="dashboard" aria-label="Dashboard">
        <div class="command-toolbar" id="dashboardToolbar">
          <div class="left">
            <div class="command-title" id="h-dashboard"><i data-lucide="radar"></i> <span data-i18n="dashboard.missionControl.title">Mission Control</span></div>
          </div>
          <div class="right">
            <div class="chips" id="agendaRange" role="group" aria-label="Agenda range">
              <button class="chip active" data-range="month">Month</button>
              <button class="chip" data-range="1d">1d</button>
              <button class="chip" data-range="3d">3d</button>
              <button class="chip" data-range="7d">7d</button>
            </div>
            <span style="width:8px"></span>
            <button id="dashQuickAddHotel" class="ghost small" title="Add hotel"><i data-lucide="bed-double"></i> Add hotel</button>
            <button id="dashOpenCC" class="secondary small" title="Open Command Center"><i data-lucide="command"></i> Command Center</button>
            <button id="dashOpenCalendar" class="ghost small" title="Open Calendar"><i data-lucide="calendar"></i> Calendar</button>
          </div>
        </div>
        <div class="command-view active" data-view="hub">
            <div class="command-hub-layout mission-control-grid">
          <div class="mission-main-col">
                <div class="mission-row" id="draggable-zone-main">
                <div class="card console-card draggable-panel" id="mission-canvas-card" data-panel="mission" draggable="true">
                  <div class="mission-placeholder full-map" aria-label="Mission canvas placeholder">
                    <div class="mission-map-container">
                      <div id="map-canvas" class="map-canvas" aria-label="Interactive tour map"></div>
                      <div class="view-toggle small mission-view-toggle" id="missionViewToggle" role="group" aria-label="Mission view">
                        <button class="view-btn active" data-view="next" aria-pressed="true">Next Show</button>
                        <button class="view-btn" data-view="upcoming" aria-pressed="false">What's Next</button>
                        <button class="view-btn" data-view="month" aria-pressed="false">This Month</button>
                        <button class="view-btn" data-view="financials" aria-pressed="false">Financials</button>
                      </div>
                      <div class="view-toggle tiny mission-layer-toggle" id="missionLayerToggle" role="group" aria-label="Map layers" style="margin-top:4px;">
                        <button class="view-btn active" data-layer="heat" aria-pressed="true" title="Show heat/financial markers">Heat</button>
                        <button class="view-btn active" data-layer="status" aria-pressed="true" title="Show status markers">Status</button>
                        <button class="view-btn active" data-layer="route" aria-pressed="true" title="Show route lines">Route</button>
                        <div class="fin-legend" id="finLegend" hidden aria-label="Financial legend" role="list">
                          <button class="legend-item" data-fin-filter="high" role="listitem" aria-pressed="true"><span class="dot high"></span>High</button>
                          <button class="legend-item" data-fin-filter="mid" role="listitem" aria-pressed="true"><span class="dot mid"></span>Mid</button>
                          <button class="legend-item" data-fin-filter="low" role="listitem" aria-pressed="true"><span class="dot low"></span>Low</button>
                          <button class="legend-item" data-fin-filter="neg" role="listitem" aria-pressed="true"><span class="dot neg"></span>Negative</button>
                        </div>
                      </div>
                      <div id="missionHero" class="mission-hero" aria-live="polite"></div>
                      <div id="missionQuick" class="hero-actions"></div>
                      <!-- Dynamic HUD with dual views -->
                      <div class="map-hud simplified" id="mapHud" aria-live="polite">
                      <div class="hud-bar simplified" id="hudFinancialBar" aria-label="Income vs Expenses" role="figure">
                        <div class="hud-bar-track">
                          <div class="hud-bar-seg income" data-seg="income" style="width:0%"><span class="seg-label" id="hudSegIncome">Income</span></div>
                          <div class="hud-bar-seg expenses" data-seg="expenses" style="width:0%" aria-describedby="hudExpensesTooltip"><span class="seg-label" id="hudSegExpenses">Expenses</span></div>
                        </div>
                        <div class="hud-expenses-tooltip" id="hudExpensesTooltip" role="tooltip" hidden>
                          <div class="tooltip-inner">
                            <div class="row"><span class="t-label">Commissions</span><span class="t-val" id="ttCommissions">‚Ç¨0</span></div>
                            <div class="row"><span class="t-label">Costs</span><span class="t-val" id="ttCosts">‚Ç¨0</span></div>
                            <div class="row"><span class="t-label">WHT</span><span class="t-val" id="ttWht">‚Ç¨0</span></div>
                            <div class="row total"><span class="t-label">Total</span><span class="t-val" id="ttTotalExp">‚Ç¨0</span></div>
                          </div>
                        </div>
                      </div>
                      <div class="hud-view" data-view-content="next">
                        <div class="hud-left">
                          <div class="hud-label" data-i18n="hud.nextShow">Next Show</div>
                          <div class="hud-title" id="hudNextTitle">‚Äî</div>
                          <div class="hud-meta" id="hudNextMeta">‚Äî</div>
                        </div>
                        <div class="hud-right">
                          <div class="hud-kpi"><span class="muted" data-i18n="hud.label.net">Estimated Net</span> <strong id="hudNet">‚Ç¨0</strong></div>
                          <div class="hud-actions primary-actions" id="hudNextActions">
                            <button id="mcOpenNextShowPrimary" class="primary small" title="Open next show details" data-i18n="btn.openShow"><i data-lucide="external-link"></i> Open Show</button>
                            <button id="mcFinance" class="ghost small" title="Finance breakdown" data-i18n="btn.financeBreakdown"><i data-lucide="circle-dollar-sign"></i></button>
                            <button id="mcAddTravel" class="ghost small" title="Add travel item" data-i18n="btn.addTravel"><i data-lucide="plane"></i></button>
                          </div>
                        </div>
                      </div>
                      <div class="hud-view" data-view-content="upcoming" hidden>
                        <div class="hud-left">
                          <div class="hud-label">What's Next</div>
                          <div class="hud-title" id="hudUpcomingTitle">Next 14 Days</div>
                          <div class="hud-meta" id="hudUpcomingCount">0 upcoming events</div>
                        </div>
                        <div class="hud-right">
                          <div class="upcoming-events" id="hudUpcomingEvents">
                            <div class="upcoming-event">
                              <div class="event-date">Loading...</div>
                              <div class="event-info">Upcoming events</div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="hud-view" data-view-content="month">
                        <div class="hud-left">
                          <div class="hud-label" data-i18n="hud.monthlySummary">Monthly Summary</div>
                          <div class="hud-title" id="hudMonthTitle">‚Äî</div>
                          <div class="hud-meta" id="hudMonthMeta">‚Äî</div>
                        </div>
                        <div class="hud-right hud-kpis-grid">
                          <div class="hud-kpi"><span class="muted" data-i18n="hud.label.income">Income</span> <strong id="hudMonthIncome">‚Ç¨0</strong></div>
                          <div class="hud-kpi"><span class="muted" data-i18n="hud.label.expenses">Expenses</span> <strong id="hudMonthExpenses" class="expense-val">‚Ç¨0</strong></div>
                          <div class="hud-kpi"><span class="muted" data-i18n="hud.label.net">Net</span> <strong id="hudMonthNet">‚Ç¨0</strong></div>
                        </div>
                      </div>
                      <div class="hud-view" data-view-content="financials" hidden>
                        <div class="hud-left">
                          <div class="hud-label" data-i18n="hud.financialIntelligence">Financial Intelligence</div>
                          <div class="hud-title" id="hudFinAvgNet">Avg Net: ‚Äî</div>
                          <div class="hud-meta" id="hudFinBest">Top Show: ‚Äî</div>
                          <div class="hud-meta" id="hudFinHighCost">Max Cost: ‚Äî</div>
                        </div>
                        <div class="hud-right" style="display:flex;flex-direction:column;gap:6px;min-width:180px;">
                          <div class="mini-breakdown" id="hudFinBreakdown" aria-label="Monthly finance breakdown" style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;font-size:11px;">
                            <div><span class="muted" data-i18n="hud.label.income">Income</span><div id="hudFinIncome">‚Ç¨0</div></div>
                            <div><span class="muted" data-i18n="hud.label.commissions">Comms</span><div id="hudFinComms">‚Ç¨0</div></div>
                            <div><span class="muted" data-i18n="hud.label.costs">Costs</span><div id="hudFinCosts">‚Ç¨0</div></div>
                          </div>
                          <div class="mini-bars" id="hudFinBars" style="display:flex;align-items:flex-end;gap:4px;height:42px;">
                            <div class="bar income" data-kind="income" style="flex:1;background:linear-gradient(180deg,#3B82F6,#1d4ed8);border-radius:3px;height:0%;transition:height .4s"></div>
                            <div class="bar comms" data-kind="comms" style="flex:1;background:linear-gradient(180deg,#F59E0B,#b45309);border-radius:3px;height:0%;transition:height .4s"></div>
                            <div class="bar costs" data-kind="costs" style="flex:1;background:linear-gradient(180deg,#EF4444,#991b1b);border-radius:3px;height:0%;transition:height .4s"></div>
                          </div>
                          <button id="hudFinFocusBtn" class="ghost tiny" title="Focus best show" style="align-self:flex-end;display:none;"><i data-lucide="target"></i> Focus Best</button>
                        </div>
                      </div>
                    </div>
                  </div>
                    <!-- Sidebar removed for full-width map -->
                  </div>
                  </div>
                </div>
              </div>

            <!-- Second sidebar removed -->

            <aside class="mission-sidebar-col" aria-label="Action Hub & Performance Panels">
              <!-- Enhanced Action Hub -->
              <div class="panel console-card panel-glass draggable-panel action-hub-enhanced" id="action-hub" data-panel="actionHub" data-testid="action-hub" draggable="true">
                <div class="panel-head action-hub-header">
                  <div class="action-hub-title">
                    <h2 data-i18n="dashboard.actionHub.title">üéØ Action Hub</h2>
                    <div class="action-hub-stats">
                      <span class="stat-pill" id="pendingCountPill">
                        <i data-lucide="alert-circle"></i>
                        <span id="pendingCountLabel">0</span> Pending
                      </span>
                      <span class="stat-pill success" id="completedCountPill">
                        <i data-lucide="check-circle"></i>
                        <span id="completedCountLabel">0</span> Done
                      </span>
                    </div>
                  </div>
                  <div class="action-hub-controls">
                    <button class="btn-ghost small" id="actionHubRefresh" title="Refresh actions">
                      <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="btn-ghost small" id="actionHubFilter" title="Filter actions">
                      <i data-lucide="filter"></i>
                    </button>
                  </div>
                </div>
                <div class="panel-body action-hub-body">
                  <div class="action-hub-tabs">
                    <button class="tab-btn active" data-tab="pending">
                      <i data-lucide="clock"></i>
                      Pending Actions
                    </button>
                    <button class="tab-btn" data-tab="shows">
                      <i data-lucide="calendar"></i>
                      This Month
                    </button>
                    <button class="tab-btn" data-tab="travel">
                      <i data-lucide="plane"></i>
                      Travel
                    </button>
                    <button class="tab-btn" data-tab="insights">
                      <i data-lucide="trending-up"></i>
                      Insights
                    </button>
                  </div>

                  <div class="action-tab-content" data-tab-content="pending">
                    <section class="dash-section" id="pending-actions" aria-label="Pending Actions">
                      <div class="section-header">
                        <h3>üö® Critical Actions</h3>
                        <div class="section-actions">
                          <select id="pendingPriorityFilter" class="small">
                            <option value="all">All Priorities</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                          </select>
                        </div>
                      </div>
                      <ul class="card-list enhanced" id="pendingList" aria-live="polite"></ul>
                      <div class="empty-state" id="pendingEmpty" style="display:none;">
                        <i data-lucide="check-circle"></i>
                        <h4>All caught up!</h4>
                        <p>No pending actions at the moment.</p>
                      </div>
                    </section>
                  </div>

                  <div class="action-tab-content" data-tab-content="shows" style="display:none;">
                    <section class="dash-section" id="month-shows" aria-label="This Month's Shows">
                      <div class="section-header">
                        <h3>üìÖ Monthly Shows</h3>
                        <div class="section-actions">
                          <div class="chips" id="moSort" role="group" aria-label="Sort shows">
                            <button class="chip active" data-sort="date">Date</button>
                            <button class="chip" data-sort="fee">Fee</button>
                            <button class="chip" data-sort="status">Status</button>
                          </div>
                        </div>
                      </div>
                      <ul class="card-list enhanced" id="showsList" aria-live="polite"></ul>
                    </section>
                  </div>

                  <div class="action-tab-content" data-tab-content="travel" style="display:none;">
                    <section class="dash-section" id="month-travel" aria-label="This Month's Travel">
                      <div class="section-header">
                        <h3>‚úàÔ∏è Travel Plans</h3>
                        <div class="section-actions">
                          <button class="btn-primary small" id="addTravelBtn">
                            <i data-lucide="plus"></i>
                            Add Travel
                          </button>
                        </div>
                      </div>
                      <ul class="card-list enhanced" id="travelList" aria-live="polite"></ul>
                    </section>
                  </div>

                  <div class="action-tab-content" data-tab-content="insights" style="display:none;">
                    <section class="dash-section" id="performance-insights">
                      <div class="section-header">
                        <h3>üìä Performance Insights</h3>
                      </div>
                      <div class="insights-grid">
                        <div class="insight-card">
                          <div class="insight-icon">
                            <i data-lucide="trending-up"></i>
                          </div>
                          <div class="insight-content">
                            <h4>Revenue Trend</h4>
                            <div class="insight-metric" id="revenueTrend">+12% vs last month</div>
                            <div class="insight-chart" id="revenueChart"></div>
                          </div>
                        </div>
                        <div class="insight-card">
                          <div class="insight-icon">
                            <i data-lucide="users"></i>
                          </div>
                          <div class="insight-content">
                            <h4>Audience Growth</h4>
                            <div class="insight-metric" id="audienceGrowth">+8% new fans</div>
                            <div class="insight-chart" id="audienceChart"></div>
                          </div>
                        </div>
                        <div class="insight-card">
                          <div class="insight-icon">
                            <i data-lucide="map-pin"></i>
                          </div>
                          <div class="insight-content">
                            <h4>Tour Efficiency</h4>
                            <div class="insight-metric" id="tourEfficiency">94% on schedule</div>
                            <div class="insight-chart" id="efficiencyChart"></div>
                          </div>
                        </div>
                      </div>
                    </section>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </section>

      <!-- Settings view -->
      <section id="settings" class="view" data-view="settings" hidden aria-labelledby="h-settings">
        <div class="command-toolbar" id="settingsToolbar">
          <div class="left">
            <div class="command-title" id="h-settings"><i data-lucide="sliders-horizontal"></i> Settings</div>
          </div>
          <div class="right" style="gap:8px;">
            <button id="openDataFolderBtn" class="ghost small" title="Open data folder"><i data-lucide="folder"></i></button>
            <button id="quickExportBtn" class="ghost small" title="Quick export"><i data-lucide="download"></i></button>
            <button id="resetSettingsBtn" class="ghost small" title="Reset settings"><i data-lucide="rotate-ccw"></i></button>
          </div>
        </div>

        <div class="command-hub-layout">
          <div class="mission-main-col">
            <!-- General -->
            <div class="panel console-card">
              <div class="panel-head">
                <h2><i data-lucide="settings"></i> General</h2>
              </div>
              <div class="panel-body">
                <form id="generalSettingsForm" class="form-grid-responsive cols-3">
                  <label>
                    Theme
                    <select id="settingTheme">
                      <option value="system">System</option>
                      <option value="dark">Dark</option>
                      <option value="light">Light</option>
                    </select>
                    <small class="field-hint">Affects colors across the app.</small>
                  </label>
                  <label>
                    Density
                    <select id="settingDensity">
                      <option value="compact">Compact</option>
                      <option value="comfortable">Comfortable</option>
                    </select>
                    <small class="field-hint">Compact fits more data; Comfortable adds spacing.</small>
                  </label>
                  <label>
                    Language
                    <select id="settingLanguage">
                      <option value="auto">Auto</option>
                      <option value="en">English</option>
                      <option value="es">Espa√±ol</option>
                    </select>
                    <small class="field-hint">UI language; content remains original.</small>
                  </label>
                </form>
              </div>
            </div>

            <!-- Finance -->
            <div class="panel console-card">
              <div class="panel-head">
                <h2><i data-lucide="dollar-sign"></i> Finance</h2>
              </div>
              <div class="panel-body">
                <form id="financialSettingsForm" class="form-grid-responsive cols-3">
                  <label>
                    Mgmt Commission (%)
                    <input id="settingMgmtComm" type="number" step="0.5" min="0" max="100" placeholder="20" />
                    <small id="hintMgmtComm" class="field-hint">Used in net estimates. Range 0‚Äì100%.</small>
                  </label>
                  <label>
                    Default Currency
                    <select id="settingCurrency">
                      <option value="EUR">EUR (‚Ç¨)</option>
                      <option value="USD">USD ($)</option>
                      <option value="GBP">GBP (¬£)</option>
                    </select>
                    <small class="field-hint">Applied to new shows and formatting.</small>
                  </label>
                  <label>
                    Default Agreement
                    <select id="settingDefaultAgreement">
                      <option value="mgmt">Mgmt %</option>
                      <option value="booking">Booking %</option>
                    </select>
                    <small class="field-hint">Controls split visualization and defaults.</small>
                  </label>
                </form>
                <div class="chips-row" id="financeToggles" role="group" aria-label="Finance toggles" style="margin-top:8px;">
                  <button class="chip" id="toggleShowPayable" aria-pressed="false">Show Pending in KPIs</button>
                  <button class="chip" id="toggleShowSimulator" aria-pressed="true">Show Simulator</button>
                </div>
              </div>
            </div>

            <!-- Calendar & Dashboard -->
            <div class="panel console-card">
              <div class="panel-head">
                <h2><i data-lucide="calendar"></i> Calendar & Dashboard</h2>
              </div>
              <div class="panel-body">
                <form id="calDashForm" class="form-grid-responsive cols-3">
                  <label>
                    Calendar Start Day
                    <select id="settingCalStart">
                      <option value="mon">Monday</option>
                      <option value="sun">Sunday</option>
                    </select>
                    <small class="field-hint">First weekday in Calendar.</small>
                  </label>
                  <label>
                    Dashboard KPIs
                    <select id="settingKpis">
                      <option value="all">All</option>
                      <option value="minimal">Minimal</option>
                      <option value="hidden">Hidden</option>
                    </select>
                    <small class="field-hint">Visibility of top KPI bar.</small>
                  </label>
                  <label>
                    Agenda Range Default
                    <select id="settingAgendaDefault">
                      <option value="month">Month</option>
                      <option value="7d">7d</option>
                      <option value="3d">3d</option>
                      <option value="1d">1d</option>
                    </select>
                    <small class="field-hint">Default range in Dashboard agenda.</small>
                  </label>
                </form>
              </div>
            </div>

            <!-- Notifications -->
            <div class="panel console-card">
              <div class="panel-head">
                <h2><i data-lucide="bell"></i> Notifications</h2>
              </div>
              <div class="panel-body">
                <form id="notificationsForm" class="form-grid-responsive cols-3">
                  <label><input id="settingNotifyOverdue" type="checkbox" /> Overdue invoices</label>
                  <label><input id="settingNotifyTravel" type="checkbox" /> Upcoming travel</label>
                  <label><input id="settingNotifyOffers" type="checkbox" /> Offer deadlines</label>
                </form>
                <div class="hero-actions" style="margin-top:8px;">
                  <button id="testNotifyBtn" class="ghost small"><i data-lucide="bell"></i> Test notification</button>
                </div>
              </div>
            </div>

            <!-- Data -->
            <div class="panel console-card">
              <div class="panel-head">
                <h2><i data-lucide="database"></i> Data</h2>
              </div>
              <div class="panel-body">
                <p class="muted" style="margin-top:0;">Manage your local application data.</p>
                <div class="hero-actions">
                  <button id="exportDataBtn" class="ghost small"><i data-lucide="download"></i> Export All Data</button>
                  <label class="ghost small" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                    <i data-lucide="upload"></i> Import Backup
                    <input id="importDataInput" type="file" accept="application/json" style="display:none;" />
                  </label>
                  <button id="resetDataBtn" class="ghost small" style="color: var(--color-warning);"><i data-lucide="trash-2"></i> Reset Demo Data</button>
                </div>
              </div>
            </div>
          </div>

          <aside class="mission-sidebar-col">
            <div class="panel console-card agencies-panel">
              <div class="panel-head agencies-head">
                <h2 class="panel-title"><i data-lucide="briefcase"></i><span>Agencies</span></h2>
                <div class="panel-tools" hidden></div>
              </div>
              <div class="panel-body agencies-body">
                <p class="muted agencies-intro">Keep agency commissions organized for quick selection in shows.</p>
                <div id="agencyList" class="agencies-list" aria-live="polite">
                  <div class="muted empty">No agencies configured.</div>
                </div>
                <form id="addAgencyForm" class="agency-form" autocomplete="off">
                  <div class="form-row stretch">
                    <label class="form-field"><span class="label">Name</span>
                      <input id="newAgencyName" type="text" placeholder="Booking Agency Name" required />
                    </label>
                    <label class="form-field size-sm"><span class="label">Comm. %</span>
                      <input id="newAgencyComm" type="number" step="0.5" min="0" max="100" placeholder="10" required />
                    </label>
                    <label class="form-field size-sm"><span class="label">Type</span>
                      <select id="newAgencyType">
                        <option value="mgmt">Mgmt</option>
                        <option value="booking">Booking</option>
                      </select>
                    </label>
                    <label class="form-field size-md"><span class="label">Base</span>
                      <select id="newAgencyBase">
                        <option value="gross">Gross</option>
                        <option value="net">Net (after costs)</option>
                      </select>
                    </label>
                    <label class="form-field checkbox-field"><input id="newAgencyDefault" type="checkbox" /> <span class="check-label">Default</span></label>
                    <div class="form-field actions-field">
                      <button id="addAgencyBtn" class="secondary" title="Add Agency" aria-label="Add Agency"><i data-lucide="plus"></i></button>
                    </div>
                  </div>
                </form>
                <div class="commission-base-global" data-legacy-base>
                  <label class="form-field inline">
                    <span class="label">Commission Base (fallback)</span>
                    <select id="commissionBaseSelect">
                      <option value="gross">Before Costs (Gross)</option>
                      <option value="net">After Costs (Net)</option>
                    </select>
                  </label>
                  <p class="hint">Applies only when a show‚Äôs selected agency predates per-agency base setting.</p>
                </div>
              </div>
            </div>
          </aside>
        </div>

        <template id="agency-row-template">
          <div class="cost-item" style="grid-template-columns: 1fr auto auto auto; align-items:center;">
            <div class="agency-details" style="display:flex; align-items:center; gap:8px;">
              <span class="agency-name" style="font-weight:600;"></span>
              <span class="agency-comm muted"></span>
              <span class="chip tiny" data-role="base-chip" hidden></span>
              <span class="chip tiny" data-role="type-chip" hidden></span>
              <span class="chip tiny" data-role="default-chip" title="Default agency" hidden>Default</span>
            </div>
            <button class="ghost small" data-action="agency-default" title="Set as default"><i data-lucide="star"></i></button>
            <button class="ghost small" data-action="agency-edit" title="Edit Agency"><i data-lucide="pencil"></i></button>
            <button class="ghost small" data-action="agency-delete" title="Delete Agency"><i data-lucide="trash-2"></i></button>
            <div class="agency-edit-row" style="grid-column: 1 / -1; display:none; gap:8px; align-items:end;">
              <label style="flex:1;">Name<input data-edit="name" type="text" placeholder="Agency name" /></label>
              <label style="width:120px;">Comm. (%)<input data-edit="comm" type="number" step="0.5" min="0" max="100" placeholder="10" /></label>
              <label style="width:120px;">Type<select data-edit="type"><option value="mgmt">Mgmt</option><option value="booking">Booking</option></select></label>
              <label style="width:140px;">Base<select data-edit="base"><option value="gross">Gross</option><option value="net">Net</option></select></label>
              <button class="small primary" data-action="agency-save"><i data-lucide="check"></i> Save</button>
              <button class="small ghost" data-action="agency-cancel"><i data-lucide="x"></i> Cancel</button>
            </div>
          </div>
        </template>
      </section>

      <!-- Manager view (old dashboard) -->
      <section id="manager" class="view" data-view="manager" hidden aria-label="Manager Dashboard">
        <div class="panel console-card" data-testid="manager-header">
          <div class="panel-body">
            <h2 class="muted" style="margin:0">Select an Artist</h2>
            <p class="muted" style="margin:6px 0 0">Click on an artist's card to access their Command Center.</p>
          </div>
        </div>
        <div id="artist-grid" class="artist-grid"></div>
        <div id="pendingInviteNotice" class="empty-state" hidden>Invitation sent ‚Äî waiting for artist to accept.</div>
        <div id="inviteSpecialCard" class="console-card" hidden style="margin-top:16px; padding:16px; border:1px solid rgba(191,255,0,.25); background:linear-gradient(180deg, rgba(20,24,30,.9), rgba(12,16,22,.9)); border-radius:12px;">
          <div style="display:flex; gap:12px; align-items:center;">
            <i data-lucide="send" style="width:22px;height:22px;color:#bfff00"></i>
            <div>
              <div style="font-weight:700;">Invitation on its way</div>
              <div class="muted">The invitation has been sent. As soon as your artist accepts, they will appear here ready to manage.</div>
            </div>
            <div style="margin-left:auto; display:flex; gap:8px;">
              <button id="resendInviteBtn" class="ghost small"><i data-lucide="repeat"></i> Resend invitation</button>
            </div>
          </div>
        </div>

        <template id="artist-card-template">
          <a href="#" class="artist-card console-card">
            <div class="card-header">
              <div class="artist-avatar"></div>
              <h2 class="artist-name"></h2>
              <span class="badge-attention" hidden><i data-lucide="alert-triangle"></i> Needs attention</span>
            </div>
            <div class="card-body">
              <div class="kpi">
                <span class="value upcoming-shows">0</span>
                <span class="label">Upcoming Shows</span>
              </div>
              <div class="kpi">
                <span class="value pending-fees">‚Ç¨0</span>
                <span class="label">Pending Fees</span>
              </div>
              <div class="actions" style="margin-left:auto; display:flex; gap:6px;">
                <button class="ghost small js-revoke" title="Revoke" style="display:none">Revoke</button>
              </div>
            </div>
          </a>
        </template>
      </section>

      <!-- Placeholder views for other nav items (not implemented) -->
      <section id="calendar" class="view" data-view="calendar" hidden>
        <nav class="dash-toc" aria-label="Calendar sections">
          <a href="#cal-toolbar">Toolbar</a>
          <a href="#cal-legend">Legend</a>
          <a href="#cal-views">Views</a>
        </nav>
        <!-- Calendar Toolbar -->
  <div class="panel console-card" id="cal-toolbar" data-testid="cal-toolbar">
          <div class="panel-head tabs" role="tablist" aria-label="Calendar views">
            <button role="tab" aria-selected="true" class="tab active" data-tab-target="month">Month</button>
            <button role="tab" aria-selected="false" class="tab" data-tab-target="week">Week</button>
            <button role="tab" aria-selected="false" class="tab" data-tab-target="day">Day</button>
          </div>
          <div class="panel-body cal-toolbar">
            <div class="cal-left">
              <button class="ghost" data-action="cal-today">Today</button>
              <button class="ghost" data-action="cal-prev">‚óÄ</button>
              <button class="ghost" data-action="cal-next">‚ñ∂</button>
              <div class="cal-title" id="cal-title">September 2025</div>
            </div>
            <div class="cal-right"></div>
          </div>
        </div>

        <!-- Legend -->
  <div class="panel console-card" id="cal-legend" data-testid="cal-legend">
          <div class="panel-body cal-legend">
            <span class="legend-item"><span class="dot income"></span> Show</span>
            <span class="legend-item"><span class="dot info"></span> Travel</span>
            <span class="legend-item"><span class="dot warn"></span> Offer/Deadline</span>
          </div>
        </div>

        <!-- Calendar Views -->
  <div class="panel console-card" id="cal-views" data-testid="cal-views">
          <div class="panel-body">
            <!-- Month View -->
            <div class="tab-content active" data-tab-content="month">
              <div class="cal-month">
                <div class="cal-grid cal-weekdays">
                  <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
                </div>
                <div class="cal-grid cal-days">
                  <div class="day other"><span class="num">1</span></div>
                  <div class="day"><span class="num">2</span><div class="pill show">City ‚Äî Venue</div></div>
                  <div class="day"><span class="num">3</span></div>
                  <div class="day"><span class="num">4</span><div class="pill travel">Flight</div></div>
                  <div class="day"><span class="num">5</span></div>
                  <div class="day"><span class="num">6</span></div>
                  <div class="day"><span class="num">7</span><div class="pill warn">Offer due</div></div>
                  <div class="day"><span class="num">8</span></div>
                  <div class="day"><span class="num">9</span></div>
                  <div class="day"><span class="num">10</span><div class="pill show">Festival</div></div>
                  <div class="day"><span class="num">11</span></div>
                  <div class="day"><span class="num">12</span></div>
                  <div class="day"><span class="num">13</span></div>
                  <div class="day"><span class="num">14</span></div>
                  <div class="day today"><span class="num">15</span><div class="pill show">Show</div></span></div>
                  <div class="day"><span class="num">16</span></div>
                  <div class="day"><span class="num">17</span></div>
                  <div class="day"><span class="num">18</span><div class="pill travel">Hotel</div></div>
                  <div class="day"><span class="num">19</span></div>
                  <div class="day"><span class="num">20</span><div class="pill warn">Invoice overdue</div></div>
                  <div class="day"><span class="num">21</span></div>
                  <div class="day"><span class="num">22</span></div>
                  <div class="day"><span class="num">23</span></div>
                  <div class="day"><span class="num">24</span></div>
                  <div class="day"><span class="num">25</span><div class="pill show">Club</div></div>
                  <div class="day"><span class="num">26</span></div>
                  <div class="day"><span class="num">27</span></div>
                  <div class="day"><span class="num">28</span></div>
                  <div class="day"><span class="num">29</span></div>
                  <div class="day"><span class="num">30</span></div>
                </div>
              </div>
            </div>

            <!-- Week View -->
            <div class="tab-content" data-tab-content="week" hidden>
              <div class="cal-week">
                <div class="cal-grid cal-weekdays">
                  <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
                </div>
                <div class="cal-week-rows">
                  <div class="slot"><span class="slot-time">09:00</span><div class="pill show">Soundcheck</div></div>
                  <div class="slot"><span class="slot-time">12:00</span></div>
                  <div class="slot"><span class="slot-time">15:00</span><div class="pill travel">Transfer</div></div>
                  <div class="slot"><span class="slot-time">18:00</span><div class="pill warn">Deadline</div></div>
                </div>
              </div>
            </div>

            <!-- Day View -->
            <div class="tab-content" data-tab-content="day" hidden>
              <div class="cal-day">
                <div class="cal-day-header">Today ‚Äî Mon, Sep 15</div>
                <ul class="cal-day-list">
                  <li><span class="time">09:00</span><span class="pill show">Load-in</span></li>
                  <li><span class="time">15:00</span><span class="pill travel">Transfer</span></li>
                  <li><span class="time">20:00</span><span class="pill show">Showtime</span></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>
    <section id="finance" class="view" data-view="finance" hidden>
  <div id="financeLive" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
  <div class="command-toolbar" id="financeToolbar">
    <div class="left">
      <div class="command-title" id="h-finance"><i data-lucide="wallet"></i> Finance</div>
    </div>
    <div class="right">
      <div class="view-toggle small">
        <button class="view-btn active" data-cview="hub" aria-pressed="true"><i data-lucide="layout-dashboard"></i> Hub</button>
        <button class="view-btn" data-cview="analysis" aria-pressed="false"><i data-lucide="list-tree"></i> Analysis</button>
      </div>
    </div>
  </div>

  <div class="command-view active" data-view="hub">
    <div class="command-hub-layout">
      <div class="mission-main-col">
        <!-- Enhanced Executive KPIs -->
        <div class="kpis" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:16px;">
            <div class="kpi card-neo">
                <div class="kpi-header">
                    <span class="kpi-label"><i data-lucide="trending-up"></i> Gross Revenue</span>
                    <div class="currency-badge" id="kpi-currency-badge">EUR</div>
                </div>
                <div class="kpi-value" id="fin-kpi-income">‚Ç¨0</div>
                <div class="kpi-sub">
                    <span id="fin-kpi-income-trend" class="trend">+0%</span>
                    vs last month
                </div>
            </div>
            <div class="kpi card-neo">
                <div class="kpi-header">
                    <span class="kpi-label"><i data-lucide="credit-card"></i> Total Expenses</span>
                    <div class="expense-alert" id="expense-alert" style="display:none;">‚ö†Ô∏è</div>
                </div>
                <div class="kpi-value" id="fin-kpi-expenses">‚Ç¨0</div>
                <div class="kpi-sub">
                    <span id="fin-kpi-expenses-breakdown">0 transactions</span>
                </div>
            </div>
            <div class="kpi card-neo">
                <div class="kpi-header">
                    <span class="kpi-label"><i data-lucide="piggy-bank"></i> Net Profit</span>
                    <div class="profitability-indicator" id="profitability-indicator">‚óè</div>
                </div>
                <div class="kpi-value" id="fin-kpi-net">‚Ç¨0</div>
                <div class="kpi-sub">
                    <span id="fin-kpi-margin">0%</span> margin
                </div>
            </div>
            <div class="kpi card-neo">
                <div class="kpi-header">
                    <span class="kpi-label"><i data-lucide="clock"></i> Outstanding</span>
                    <div class="urgency-badge" id="urgency-badge" style="display:none;">!</div>
                </div>
                <div class="kpi-value" id="fin-kpi-payable">‚Ç¨0</div>
                <div class="kpi-sub">
                    <span id="fin-kpi-overdue">0 overdue</span>
                </div>
            </div>
        </div>

        <!-- Professional Charts Section -->
        <div id="professional-finance-charts" style="margin-top:16px;">
          <!-- React provider + toolbar + charts grid will mount here dynamically -->
        </div>
        <!-- Legacy static charts (kept temporarily for fallback) -->
        <div style="display:grid; grid-template-columns: 2fr 1fr; gap:16px; margin-top:16px;" hidden>
          <!-- Waterfall Cash Flow Analysis -->
          <div class="card console-card" id="cashflow-waterfall-card">
            <div class="panel-head forecaster-header">
              <h2 style="margin:0"><i data-lucide="activity"></i> Cash Flow Analysis</h2>
              <div class="chart-controls">
                <select id="cashflow-period" class="ghost tiny">
                  <option value="monthly">Monthly</option>
                  <option value="quarterly">Quarterly</option>
                  <option value="yearly">Yearly</option>
                </select>
                <button id="resetFinanceViewBtn" class="ghost tiny" style="margin-left:12px; display:none;">
                  <i data-lucide="rotate-ccw"></i> Reset
                </button>
              </div>
            </div>
            <div class="panel-body" style="height:320px; padding:8px; position:relative;">
              <div id="cashflow-waterfall-chart" style="width:100%; height:100%;"></div>
              <div id="cashflowTooltip" class="chart-tooltip" style="position:absolute; display:none;"></div>
            </div>
          </div>

          <!-- Profitability Heatmap -->
          <div class="card console-card" id="profitability-heatmap-card">
            <div class="panel-head">
              <h2 style="margin:0"><i data-lucide="map"></i> Tour Profitability</h2>
            </div>
            <div class="panel-body" style="height:320px; padding:8px; position:relative;">
              <div id="profitability-heatmap" style="width:100%; height:100%;"></div>
            </div>
          </div>
        </div>

        <!-- Multi-Currency Exchange Rates Panel -->
        <div class="card console-card" id="currency-rates-card" style="margin-top:16px;">
          <div class="panel-head">
            <h2 style="margin:0"><i data-lucide="banknote"></i> Exchange Rates</h2>
            <div class="currency-controls">
              <select id="base-currency" class="ghost tiny">
                <option value="EUR">EUR (Euro)</option>
                <option value="USD">USD (Dollar)</option>
                <option value="GBP">GBP (Pound)</option>
              </select>
              <span class="rate-update-time" id="rate-update-time">Updated: --</span>
            </div>
          </div>
          <div class="panel-body">
            <div class="currency-grid" id="currency-rates-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px;">
              <!-- Currency rates will be populated here -->
            </div>
          </div>
        </div>

  <!-- Additional Professional Charts (legacy) -->
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-top:16px;" hidden>
          <!-- Revenue Breakdown Chart -->
          <div class="card console-card" id="revenue-breakdown-card">
            <div class="panel-head">
              <h2 style="margin:0"><i data-lucide="bar-chart-3"></i> Revenue Breakdown</h2>
            </div>
            <div class="panel-body" style="height:200px; padding:8px;">
              <canvas id="revenue-breakdown-chart"></canvas>
            </div>
          </div>

          <!-- Cash Flow Trend Chart -->
          <div class="card console-card" id="cashflow-trend-card">
            <div class="panel-head">
              <h2 style="margin:0"><i data-lucide="trending-up"></i> Cash Flow Trend</h2>
            </div>
            <div class="panel-body" style="height:200px; padding:8px;">
              <canvas id="cashflow-trend-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <aside class="mission-sidebar-col">
        <!-- Smart Action Center with ML Insights -->
        <div class="card console-card" id="action-center-section">
          <div class="panel-head">
            <h2><i data-lucide="brain"></i> Smart Insights</h2>
            <div class="insight-refresh" id="insight-refresh">
              <button class="ghost tiny" title="Refresh insights"><i data-lucide="refresh-cw"></i></button>
            </div>
          </div>
          <div class="panel-body" id="finance-action-center" style="display:grid; gap:8px;">
            <div class="insight-item priority-high" style="display:none;" id="cash-flow-warning">
              <div class="insight-icon">‚ö†Ô∏è</div>
              <div class="insight-content">
                <div class="insight-title">Cash Flow Alert</div>
                <div class="insight-desc">Projected shortfall in 3 months</div>
              </div>
            </div>
            <div class="insight-item priority-medium" style="display:none;" id="expense-anomaly">
              <div class="insight-icon">üìä</div>
              <div class="insight-content">
                <div class="insight-title">Expense Anomaly</div>
                <div class="insight-desc">Travel costs 40% above average</div>
              </div>
            </div>
            <div class="insight-item priority-low" id="default-insight">
              <div class="insight-icon">‚úÖ</div>
              <div class="insight-content">
                <div class="insight-title">All systems healthy</div>
                <div class="insight-desc">No critical financial issues detected</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Advanced Expense Categorization -->
        <div class="card console-card" id="expense-categorization-section">
          <div class="panel-head">
            <h2><i data-lucide="tags"></i> Expense Categories</h2>
            <div class="category-controls">
              <button class="ghost tiny" id="auto-categorize-btn" title="Auto-categorize expenses">
                <i data-lucide="zap"></i>
              </button>
            </div>
          </div>
          <div class="panel-body">
            <div id="expense-category-chart" style="height:160px; position:relative;">
              <!-- Professional donut chart will be rendered here -->
            </div>
            <div class="category-legend" id="category-legend" style="margin-top:12px;">
              <!-- Category breakdown will be populated here -->
            </div>
          </div>
        </div>

        <!-- Tax Compliance Dashboard -->
        <div class="card console-card" id="tax-compliance-section">
          <div class="panel-head">
            <h2><i data-lucide="file-text"></i> Tax Status</h2>
          </div>
          <div class="panel-body">
            <div class="tax-status-grid" style="display:grid; gap:8px;">
              <div class="tax-item">
                <span class="tax-label">Deductible Expenses</span>
                <span class="tax-value" id="tax-deductible">‚Ç¨0</span>
              </div>
              <div class="tax-item">
                <span class="tax-label">VAT Collected</span>
                <span class="tax-value" id="tax-vat-collected">‚Ç¨0</span>
              </div>
              <div class="tax-item">
                <span class="tax-label">VAT Reclaimable</span>
                <span class="tax-value" id="tax-vat-reclaimable">‚Ç¨0</span>
              </div>
              <div class="tax-item">
                <span class="tax-label">Q4 Estimate</span>
                <span class="tax-value" id="tax-estimate">‚Ç¨0</span>
              </div>
            </div>
            <button class="ghost small" id="export-tax-report" style="margin-top:12px; width:100%;">
              <i data-lucide="download"></i> Export Tax Report
            </button>
          </div>
        </div>

        <!-- Settlement Tracking -->
        <div class="card console-card" id="settlement-tracking-section">
          <div class="panel-head">
            <h2><i data-lucide="handshake"></i> Settlements</h2>
          </div>
          <div class="panel-body">
            <div class="settlement-summary" id="settlement-summary">
              <div class="settlement-item pending">
                <div class="settlement-status">‚óè</div>
                <div class="settlement-content">
                  <div class="settlement-title">Pending</div>
                  <div class="settlement-amount" id="settlements-pending">‚Ç¨0</div>
                </div>
              </div>
              <div class="settlement-item processing">
                <div class="settlement-status">‚óè</div>
                <div class="settlement-content">
                  <div class="settlement-title">Processing</div>
                  <div class="settlement-amount" id="settlements-processing">‚Ç¨0</div>
                </div>
              </div>
              <div class="settlement-item completed">
                <div class="settlement-status">‚óè</div>
                <div class="settlement-content">
                  <div class="settlement-title">Completed</div>
                  <div class="settlement-amount" id="settlements-completed">‚Ç¨0</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Annual Progress -->
        <div class="panel console-card" id="annual-progress" data-testid="annual-progress">
          <div class="panel-head">
            <h2><i data-lucide="target"></i> Annual Goals</h2>
            <div class="goal-year-selector">
              <span id="goal-year">2025</span>
            </div>
          </div>
          <div class="panel-body progress" id="annualProgressBody" aria-live="polite" aria-atomic="true">
            <div class="progress-row" data-metric="income">
              <span>Revenue Goal</span>
              <div class="bar"><span></span></div>
              <span class="val" id="apIncome">0%</span>
            </div>
            <div class="progress-row" data-metric="shows">
              <span>Performance Goal</span>
              <div class="bar"><span></span></div>
              <span class="val" id="apShows">0%</span>
            </div>
            <div class="progress-row" data-metric="countries">
              <span>Market Expansion</span>
              <div class="bar"><span></span></div>
              <span class="val" id="apCountries">0%</span>
            </div>
            <div class="progress-row" data-metric="profit-margin">
              <span>Profit Margin</span>
              <div class="bar"><span></span></div>
              <span class="val" id="apProfitMargin">0%</span>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="command-view" data-view="analysis">
    <div class="card console-card" id="finance-analysis">
      <div class="panel-head">
        <h2><i data-lucide="list-tree"></i> Analysis</h2>
        <div id="analysis-tabs" class="tabs" role="tablist" aria-label="Finance analysis tabs" style="margin-left:auto;">
          <button id="analysis-tab-feed" class="tab active" role="tab" aria-selected="true" aria-controls="finance-feed-view" data-view="feed">Feed</button>
          <button id="analysis-tab-breakdown" class="tab" role="tab" aria-selected="false" aria-controls="finance-breakdown-view" data-view="breakdown">Breakdown</button>
          <button id="analysis-tab-expenses" class="tab" role="tab" aria-selected="false" aria-controls="finance-expenses-view" data-view="expenses">Expenses</button>
        </div>
      </div>
      <div class="panel-body">
        <div id="finance-feed-view" class="analysis-pane active" role="tabpanel" aria-labelledby="analysis-tab-feed">
          <div class="chips-toolbar">
            <div class="chips-group" id="feedTypeToggle" role="group" aria-label="Feed type">
              <button class="view-btn active" data-feed-type="all">All</button>
              <button class="view-btn" data-feed-type="income">Income</button>
              <button class="view-btn" data-feed-type="expense">Expenses</button>
            </div>
            <div class="chips-group" id="feedIncomeScope" role="group" aria-label="Income scope">
              <button class="view-btn active" data-feed-paid="0">Any Status</button>
              <button class="view-btn" data-feed-paid="1">Paid Only</button>
            </div>
            <div class="chips-group" role="search">
              <input type="search" id="financeFeedSearch" placeholder="Search feed‚Ä¶" aria-label="Search finance feed">
              <button id="feedResetFilters" class="ghost small" title="Reset filters" aria-label="Reset filters"><i data-lucide="rotate-ccw"></i></button>
            </div>
          </div>
          <div id="financeFeedMeta" class="muted" style="margin-bottom:8px;" aria-live="polite" aria-atomic="true"></div>
          <div class="table-responsive">
            <table class="table compact" style="width:100%">
              <thead><tr><th>Date</th><th>Type</th><th>Description</th><th class="numeric">Amount</th><th>Status</th></tr></thead>
              <tbody id="financeFeedTbody"></tbody>
            </table>
          </div>
          <div id="financeTotalsBar" class="totals-bar" style="margin-top:12px; border-top: 1px solid var(--color-border); padding-top: 10px;" aria-live="polite" aria-atomic="true"></div>
        </div>
        <!-- Breakdown Pane -->
        <div id="finance-breakdown-view" class="analysis-pane" role="tabpanel" aria-labelledby="analysis-tab-breakdown" hidden>
          <div class="forecaster-grid">
            <div class="card console-card">
              <div class="panel-head"><h3 style="margin:0; font-size:14px;"><i data-lucide="layout-grid"></i> By Category</h3></div>
              <div class="panel-body" style="height: 280px; position: relative;">
                <canvas id="breakdownByCategoryChart" aria-label="Expenses by category donut"></canvas>
                <div id="categoryEmptyState" class="empty-state-placeholder" hidden></div>
              </div>
            </div>
            <div class="card console-card">
              <div class="panel-head"><h3 style="margin:0; font-size:14px;"><i data-lucide="briefcase"></i> By Vendor</h3></div>
              <div class="panel-body" style="height: 280px; position: relative;">
                <canvas id="breakdownByVendorChart" aria-label="Expenses by vendor donut"></canvas>
                <div id="vendorEmptyState" class="empty-state-placeholder" hidden></div>
              </div>
            </div>
          </div>
        </div>
        <!-- Expenses Pane (optional, can reuse feed filters to show only expenses) -->
        <div id="finance-expenses-view" class="analysis-pane" role="tabpanel" aria-labelledby="analysis-tab-expenses" hidden>
          <div class="muted" style="margin-bottom:8px;">Tip: Use the Feed tab and select ‚ÄúExpenses‚Äù to view itemized costs. A dedicated expenses view will arrive later.</div>
        </div>
        </div>
    </div>
  </div>
</section>
  <section id="command-center" class="view" data-view="command-center" hidden>
        <!-- Toolbar -->
  <div class="panel console-card" id="cc-toolbar" data-testid="cc-toolbar">
          <div class="panel-body cc-toolbar">
            <div class="cc-left">
              <div class="cc-search">
                <input type="search" placeholder="Search shows" aria-label="Search shows" />
                <button class="ghost small" data-action="cc-clear-search" title="Clear search" aria-label="Clear search" style="margin-left:6px;">‚úï</button>
              </div>
              <div class="cc-chips" role="group" aria-label="Status filters">
                <button class="chip active" data-action="filter-all">All</button>
                <button class="chip" data-action="filter-confirmed">Confirmed</button>
                <button class="chip" data-action="filter-tentative">Tentative</button>
                <button class="chip warn" data-action="filter-overdue">Overdue</button>
                <button class="chip danger" data-action="filter-cancelled">Cancelled</button>
                <button class="chip info" data-action="filter-pending">Pending</button>
              </div>
              <div class="cc-range" role="group" aria-label="Date range">
                <button class="chip" data-action="range-upcoming">Upcoming</button>
                <button class="chip" data-action="range-this-month">This month</button>
                <button class="chip" data-action="range-next-month">Next month</button>
                <button class="chip" data-action="range-this-year">This year</button>
              </div>
            </div>
            <div class="cc-right">
              <select class="cc-select" aria-label="Sort by">
                <option value="date">Sort: Date</option>
                <option value="fee">Sort: Fee</option>
                <option value="status">Sort: Status</option>
                <option value="location">Sort: Location</option>
              </select>
              <span id="cc-result-count" class="muted" aria-live="polite" style="margin:0 8px 0 6px; min-width:60px; display:inline-block; text-align:right;">0</span>
              <button class="ghost" data-action="new-show">New show</button>
            </div>
          </div>
        </div>

        <!-- Tabs -->
  <div class="panel console-card" data-testid="cc-tabs">
          <div class="panel-head tabs" role="tablist" aria-label="Command Center views">
            <button role="tab" aria-selected="true" class="tab active" data-tab-target="cards">Cards</button>
            <button role="tab" aria-selected="false" class="tab" data-tab-target="table">Table</button>
            <button role="tab" aria-selected="false" class="tab" data-tab-target="kanban">Kanban</button>
            <button role="tab" aria-selected="false" class="tab" data-tab-target="timeline">Timeline</button>
          </div>
          <div class="panel-body">
            <!-- Cards -->
      <div class="tab-content active" data-tab-content="cards" id="cc-cards">
              <ul class="cc-cards">
                <li class="cc-card">
                  <div class="cc-card-top">
                    <span class="cc-date">Sep 15</span>
                    <span class="badge success">Confirmed</span>
                  </div>
                  <div class="cc-title">City ‚Äî Venue</div>
                  <div class="cc-meta">Country ¬∑ Capacity</div>
                  <div class="cc-actions">
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-finance">Finance</button>
                    <button class="tiny" data-action="cc-travel">Travel</button>
                  </div>
                </li>
                <li class="cc-card">
                  <div class="cc-card-top">
                    <span class="cc-date">Sep 18</span>
                    <span class="badge info">Tentative</span>
                  </div>
                  <div class="cc-title">Another City ‚Äî Hall</div>
                  <div class="cc-meta">Country ¬∑ 2,500 cap</div>
                  <div class="cc-actions">
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-offer">Offer</button>
                    <button class="tiny" data-action="cc-contact">Contact</button>
                  </div>
                </li>
                <li class="cc-card">
                  <div class="cc-card-top">
                    <span class="cc-date">Sep 20</span>
                    <span class="badge warn">Overdue</span>
                  </div>
                  <div class="cc-title">City ‚Äî Arena</div>
                  <div class="cc-meta">Invoice pending ¬∑ 5,000 cap</div>
                  <div class="cc-actions">
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-remind">Remind</button>
                    <button class="tiny" data-action="cc-mark-paid">Mark paid</button>
                  </div>
                </li>
                <li class="cc-card">
                  <div class="cc-card-top">
                    <span class="cc-date">Sep 25</span>
                    <span class="badge danger">Cancelled</span>
                  </div>
                  <div class="cc-title">Town ‚Äî Club</div>
                  <div class="cc-meta">Refund processing</div>
                  <div class="cc-actions">
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-notes">Notes</button>
                  </div>
                </li>
                <li class="cc-card skel"></li>
                <li class="cc-card skel"></li>
                <li class="cc-card skel"></li>
                <li class="cc-card skel"></li>
              </ul>
            </div>

            <!-- Table -->
            <div class="tab-content" data-tab-content="table" id="cc-table" hidden>
              <div class="cc-table">
                <div class="cc-thead">
                  <div>Date</div><div>City</div><div>Venue</div><div>Status</div><div>Actions</div>
                </div>
                <div class="cc-row">
                  <div>Sep 15</div><div>City</div><div>Venue</div><div><span class="badge success">Confirmed</span></div>
                  <div>
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-finance">Finance</button>
                  </div>
                </div>
                <div class="cc-row">
                  <div>Sep 18</div><div>Another City</div><div>Hall</div><div><span class="badge info">Tentative</span></div>
                  <div>
                    <button class="tiny" data-action="cc-open">Open</button>
                    <button class="tiny" data-action="cc-offer">Offer</button>
                  </div>
                </div>
                <div class="cc-row">
                  <div>Sep 20</div><div>City</div><div>Arena</div><div><span class="badge warn">Overdue</span></div>
                  <div>
                    <button class="tiny" data-action="cc-remind">Remind</button>
                    <button class="tiny" data-action="cc-mark-paid">Mark paid</button>
                  </div>
                </div>
                <div class="cc-row">
                  <div>Sep 25</div><div>Town</div><div>Club</div><div><span class="badge danger">Cancelled</span></div>
                  <div>
                    <button class="tiny" data-action="cc-notes">Notes</button>
                  </div>
                </div>
                <div class="cc-row">
                  <div class="skel-bar"></div><div class="skel-bar"></div><div class="skel-bar"></div><div class="skel-badge"></div><div class="skel-actions"></div>
                </div>
              </div>
            </div>

            <!-- Kanban -->
            <div class="tab-content" data-tab-content="kanban" id="cc-kanban" hidden>
              <div class="cc-kanban">
                <div class="kan-col">
                  <div class="kan-head">Backlog <span class="kan-count">2</span></div>
                  <div class="kan-card">Offer ‚Äî Placeholder</div>
                  <div class="kan-card">Hold ‚Äî Placeholder</div>
                  <div class="kan-card skel"></div>
                </div>
                <div class="kan-col">
                  <div class="kan-head">Scheduled <span class="kan-count">3</span></div>
                  <div class="kan-card">City ‚Äî Venue</div>
                  <div class="kan-card">Town ‚Äî Club</div>
                  <div class="kan-card">Another City ‚Äî Hall</div>
                  <div class="kan-card skel"></div>
                </div>
                <div class="kan-col">
                  <div class="kan-head">Pending Payment <span class="kan-count">1</span></div>
                  <div class="kan-card">Arena ‚Äî Invoice</div>
                  <div class="kan-card skel"></div>
                </div>
                <div class="kan-col">
                  <div class="kan-head">Completed <span class="kan-count">2</span></div>
                  <div class="kan-card">Festival ‚Äî Main Stage</div>
                  <div class="kan-card">City ‚Äî Theater</div>
                  <div class="kan-card skel"></div>
                </div>
              </div>
            </div>

            <!-- Timeline -->
            <div class="tab-content" data-tab-content="timeline" id="cc-timeline" hidden>
              <ul class="cc-timeline">
                <li>
                  <span class="cc-time">Sep 08</span>
                  <span class="cc-dot status-info"></span>
                  <span class="cc-line"></span>
                  <div class="cc-event">
                    <div class="cc-event-title">Offer sent</div>
                    <div class="cc-event-meta muted">Awaiting response</div>
                  </div>
                </li>
                <li>
                  <span class="cc-time">Sep 10</span>
                  <span class="cc-dot status-warn"></span>
                  <span class="cc-line"></span>
                  <div class="cc-event">
                    <div class="cc-event-title">Invoice reminder</div>
                    <div class="cc-event-meta muted">Due in 2d</div>
                  </div>
                </li>
                <li>
                  <span class="cc-time">Sep 12</span>
                  <span class="cc-dot status-success"></span>
                  <span class="cc-line"></span>
                  <div class="cc-event">
                    <div class="cc-event-title">Contract signed</div>
                    <div class="cc-event-meta muted">City ‚Äî Venue</div>
                  </div>
                </li>
                <li>
                  <span class="cc-time">Sep 15</span>
                  <span class="cc-dot status-success"></span>
                  <span class="cc-line"></span>
                  <div class="cc-event">
                    <div class="cc-event-title">Show day</div>
                    <div class="cc-event-meta muted">Load-in 15:00</div>
                  </div>
                </li>
                <li>
                  <span class="cc-time">Sep 20</span>
                  <span class="cc-dot status-danger"></span>
                  <span class="cc-line"></span>
                  <div class="cc-event">
                    <div class="cc-event-title">Payment overdue</div>
                    <div class="cc-event-meta muted">Arena ‚Äî Invoice</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
    </div>
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- Enhanced Finance Dashboard Integration -->
  <script type="module" src="/src/app.ts"></script>
  
  <!-- Show Detail Modal -->
  <div id="showModal" class="modal modal--fullscreen" role="dialog" aria-modal="true" aria-labelledby="showModalTitle" hidden>
    <div class="modal-backdrop"></div>
    <div class="modal-dialog glass">
      <div class="modal-content">
        <header class="modal-header">
          <h2 id="showModalTitle" class="command-title">
            <i data-lucide="ticket"></i>
            <span id="showHeaderText">Open Show</span>
            <span id="showHeaderStatus" class="badge" hidden></span>
            <span id="showHeaderEdited" class="muted" style="margin-left:8px; font-size:12px;" hidden>¬∑ Last edited just now</span>
          </h2>
          <button class="ghost close-modal" aria-label="Close"><i data-lucide="x"></i></button>
        </header>
        <div class="modal-body">
          <div id="showModalLive" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
          <div id="showFormErrors" class="form-errors" style="display:none; margin-bottom:8px;"></div>
          <div id="showMiniBar" class="mini-kpis-row" aria-live="polite" aria-atomic="true">
            <span class="chip small">Income <strong id="showMiniIncome">‚Ç¨0</strong></span>
            <span class="chip small">Expenses <strong id="showMiniExpenses">‚Ç¨0</strong></span>
            <span class="chip small">Payable <strong id="showMiniPayable">‚Ç¨0</strong></span>
          </div>
          <div class="tabs show-editor-tabs" role="tablist" aria-label="Show sections">
            <button class="tab active" role="tab" aria-selected="true" aria-controls="tab-details" id="tabBtnDetails" data-tab="details">Details</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="tab-status" id="tabBtnStatus" data-tab="status">Status</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="tab-financials" id="tabBtnFinancials" data-tab="financials">Financials</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="tab-costs" id="tabBtnCosts" data-tab="costs">Costs</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="tab-notes" id="tabBtnNotes" data-tab="notes">Notes</button>
          </div>
          <div class="show-editor-layout">
            <div class="main-col">
              <div class="panel console-card panel-fieldset tab-panel" id="tab-details" role="tabpanel" aria-labelledby="tabBtnDetails" data-tab-panel="details">
                <div class="legend-row"><i data-lucide="map-pin"></i> <span class="legend-chip">Show Details</span></div>
                <div id="sd-body" class="fieldset-body">
                <!-- mini kpis moved to sticky bar above tabs -->
                <div class="form-grid-responsive">
                  <div class="main-details">
                    <label>Date<input id="showDate" type="date" /></label>
                    <label>Venue<input id="showVenue" type="text" placeholder="e.g., The Grand" /></label>
                    <label>City<input id="showCity" type="text" placeholder="e.g., New York" /></label>
                    <label>Country<input id="showCountry" type="text" placeholder="e.g., USA" /></label>
                  </div>
                  <div id="showEditorMap" class="mini-map" aria-label="Location preview map"></div>
                </div>
                </div>
              </div>
              <div class="panel console-card panel-fieldset tab-panel" id="tab-status" role="tabpanel" aria-labelledby="tabBtnStatus" data-tab-panel="status" hidden>
                <div class="legend-row"><i data-lucide="shield-check"></i> <span class="legend-chip">Status & Payment</span></div>
                <div id="sp-body" class="fieldset-body">
                <div class="form-grid-responsive">
                  <label>Booking Status
                    <select id="showStatus">
                      <option>Inquiry</option><option>Offer</option><option>Hold 1</option><option>Hold 2</option><option>Hold 3</option><option>Confirmed</option><option>Announced</option><option>On-Sale</option><option>Settled</option><option>Cancelled</option><option>Postponed</option>
                    </select>
                  </label>
                  <label>Payment Status
                    <select id="showPaymentStatus">
                      <option value="">‚Äî</option><option>Paid</option><option>Pending</option><option>Overdue</option>
                    </select>
                  </label>
                </div>
                <!-- Quick actions styled like hero -->
                <div class="hero-actions">
                  <button id="qaOpen" class="ghost small"><i data-lucide="external-link"></i> Open</button>
                  <button id="qaDetails" class="ghost small"><i data-lucide="file-text"></i> Details</button>
                  <button id="qaFinance" class="ghost small"><i data-lucide="circle-dollar-sign"></i> Finance</button>
                  <button id="qaAddFlight" class="ghost small"><i data-lucide="plane"></i> Add flight</button>
                  <button id="qaAddHotel" class="ghost small"><i data-lucide="bed-double"></i> Add hotel</button>
                  <button id="qaMarkPaid" class="primary small">Mark paid</button>
                  <span id="showAttentionChip" class="chip warn small" style="margin-left:auto;">Needs attention</span>
                </div>
                </div>
              </div>
              <div class="panel console-card panel-fieldset tab-panel" id="tab-financials" role="tabpanel" aria-labelledby="tabBtnFinancials" data-tab-panel="financials" hidden>
                <div class="legend-row"><i data-lucide="circle-dollar-sign"></i> <span class="legend-chip">Financials</span></div>
                <div id="fin-body" class="fieldset-body">
                <div class="form-grid-responsive cols-4">
                  <label>Fee Amount<input id="showFeeAmount" type="number" step="0.01" placeholder="10000" />
                    <div class="mini-summary muted" style="font-size:12px; margin-top:4px; display:flex; gap:10px; flex-wrap:wrap;">
                      <span>Comm: <strong id="liveComm">‚Ç¨0</strong></span>
                      <span>Net: <strong id="liveNet">‚Ç¨0</strong></span>
                    </div>
                  </label>
                  <label>Currency<select id="showFeeCurrency"><option>EUR</option><option>USD</option></select></label>
                  <label>WHT (%)
                    <input id="showWhtPercent" type="number" step="0.01" min="0" max="100" placeholder="0" aria-describedby="whtHelp" />
                    <span id="whtHelp" class="muted" style="display:block;font-size:11px;line-height:1.2; margin-top:4px;">Withholding Tax retained at source. Subtracted from fee before net is computed.</span>
                  </label>
                  <label>Mgmt Agency<select id="showMgmtAgency"></select></label>
                                   <label>Booking Agency<select id="showBookingAgency"></select></label>
                </div>
                <div class="financial-breakdown-grid">
                  <div class="form-inputs"></div>
                  <div class="financial-summary-visual" aria-live="polite" aria-atomic="true">
                    <h4 style="margin:12px 0 8px; font-size:13px; font-weight:600; letter-spacing:.01em;">Net Breakdown</h4>
                    <div class="progress-bar-stack" role="presentation">
                      <div id="barWht" class="bar-segment wht" style="width:0%"></div>
                      <div id="barNet" class="bar-segment net" style="width:0%"></div>
                      <div id="barComm" class="bar-segment comm" style="width:0%"></div>
                      <div id="barCosts" class="bar-segment costs" style="width:0%"></div>
                    </div>
                    <ul class="financial-legend">
                      <li><span class="dot wht"></span>WHT: <strong id="summaryWht">‚Ç¨0</strong></li>
                      <li><span class="dot net"></span>Net: <strong id="summaryNet">‚Ç¨0</strong></li>
                      <li><span class="dot comm"></span>Commissions: <strong id="summaryComm">‚Ç¨0</strong> <small class="muted" id="summaryCommBreakdown" style="display:block;font-size:11px;">Mgmt ‚Äî / Booking ‚Äî</small></li>
                      <li><span class="dot costs"></span>Costs: <strong id="summaryCosts">‚Ç¨0</strong></li>
                    </ul>
                  </div>
                </div>
                </div>
              </div>
              <div class="panel console-card panel-fieldset tab-panel" id="tab-costs" role="tabpanel" aria-labelledby="tabBtnCosts" data-tab-panel="costs" hidden>
                <div class="legend-row"><i data-lucide="trending-down"></i> <span class="legend-chip">Per-show Costs</span></div>
                <div id="costs-body" class="fieldset-body">
                <div class="costs-layout">
                  <div class="costs-input-area">
                    <div class="quick-costs" style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px;">
                      <button class="ghost tiny qc-btn" data-qc="Flights:500">+ Flights ‚Ç¨500</button>
                      <button class="ghost tiny qc-btn" data-qc="Hotel:200">+ Hotel ‚Ç¨200</button>
                      <button class="ghost tiny qc-btn" data-qc="Transport:150">+ Transport ‚Ç¨150</button>
                      <button class="ghost tiny qc-btn" data-qc="Production:400">+ Production ‚Ç¨400</button>
                    </div>
                    <div id="showCostsList" class="costs-list" aria-live="polite"></div>
                    <div class="add-cost-row">
                      <label class="visually-hidden" for="newCostType">Type</label>
                      <select id="newCostType">
                        <option>Flights</option><option>Hotel</option><option>Tour Manager</option><option>Transport</option><option>Visas</option><option>SFX</option><option>Production</option><option>Hospitality</option><option>Camera</option><option>Per Diem</option><option>Misc</option>
                      </select>
                      <label class="visually-hidden" for="newCostDesc">Description</label>
                      <input id="newCostDesc" placeholder="Description (optional)" />
                      <label class="visually-hidden" for="newCostAmt">Amount</label>
                      <input id="newCostAmt" type="number" step="0.01" placeholder="Amount (EUR)" />
                      <button id="addCostBtn" class="secondary" title="Add Cost"><i data-lucide="plus"></i></button>
                    </div>
                  </div>
                  <div class="costs-visual">
                    <canvas id="costsDonutChart" width="260" height="260" aria-label="Costs distribution" role="img"></canvas>
                  </div>
                </div>
                </div>
              </div>
            </div>
            <div class="side-col tab-panel" id="tab-notes" role="tabpanel" aria-labelledby="tabBtnNotes" data-tab-panel="notes" hidden>
              <div class="panel console-card panel-fieldset">
                <div class="legend-row"><i data-lucide="align-left"></i> <span class="legend-chip">Notes</span></div>
                <div id="notes-body" class="fieldset-body">
                  <textarea id="showNotes" rows="10" placeholder="Notes for ops team..."></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer class="modal-footer">
          <div class="show-editor-totals" aria-live="polite" aria-atomic="true">
            <div class="total-item"><span class="label">Gross</span><span id="showGross" class="value">‚Ç¨0</span></div>
            <div class="total-item"><span class="label">Commissions</span><span id="showCommissions" class="value">‚Ç¨0</span></div>
            <div class="total-item"><span class="label">Costs</span><span id="showCosts" class="value">‚Ç¨0</span></div>
            <div class="total-item net"><span class="label">Net (EUR)</span><span id="showNet" class="value">‚Ç¨0</span></div>
          </div>
          <div class="right">
            <button class="ghost close-modal">Cancel</button>
            <button id="saveShowBtn" class="primary">Save</button>
          </div>
        </footer>
      </div>
    </div>
  </div>

  <!-- Finance Detail Modal -->
  <div id="financeModal" class="modal modal--sm" role="dialog" aria-modal="true" aria-labelledby="financeModalTitle" hidden>
    <div class="modal-backdrop"></div>
    <div class="modal-dialog glass">
      <div class="modal-content">
        <header class="modal-header">
          <h2 id="financeModalTitle" class="command-title"><i data-lucide="circle-dollar-sign"></i> Finance Breakdown</h2>
          <button class="ghost close-modal" aria-label="Close"><i data-lucide="x"></i></button>
        </header>
        <div class="modal-body">
          <fieldset class="panel console-card">
            <legend><i data-lucide="gauge"></i> Summary</legend>
            <div class="form-grid-responsive cols-2">
              <div>
                <div class="muted">Income</div>
                <div id="finDetIncome" class="kpi-value">‚Ç¨0</div>
              </div>
              <div>
                <div class="muted">Expenses</div>
                <div id="finDetExpenses" class="kpi-value">‚Ç¨0</div>
              </div>
              <div>
                <div class="muted">Net</div>
                <div id="finDetNet" class="kpi-value">‚Ç¨0</div>
              </div>
              <div id="finDetPayableWrap">
                <div class="muted">Payable</div>
                <div id="finDetPayable" class="kpi-value">‚Ç¨0</div>
              </div>
            </div>
          </fieldset>
          <div class="section-sep" role="separator" aria-hidden="true"></div>
          <fieldset class="panel console-card">
            <legend><i data-lucide="list"></i> Breakdown</legend>
            <div id="finLineItems" class="list"></div>
          </fieldset>
          <div class="section-sep" role="separator" aria-hidden="true"></div>
          <fieldset class="panel console-card">
            <legend><i data-lucide="calculator"></i> Totals</legend>
            <div id="finTotals" class="list">
              <div class="row"><span class="muted">Fee (gross)</span><span id="finTotFee">‚Ç¨0</span></div>
              <div class="row"><span class="muted">WHT</span><span id="finTotWht">‚Ç¨0</span></div>
              <div class="row"><span class="muted">Commissions</span><span id="finTotComm">‚Ç¨0</span></div>
              <div class="row"><span class="muted">Other costs</span><span id="finTotCosts">‚Ç¨0</span></div>
              <hr />
              <div class="row net"><strong>Net</strong><strong id="finTotNet">‚Ç¨0</strong></div>
              <div class="row" id="finTotPayableRow" style="display:none;"><span class="muted">Payable</span><strong id="finTotPayable">‚Ç¨0</strong></div>
            </div>
          </fieldset>
        </div>
        <footer class="modal-footer">
          <button class="ghost close-modal">Close</button>
        </footer>
      </div>
    </div>
  </div>
  </body>
  </html>
